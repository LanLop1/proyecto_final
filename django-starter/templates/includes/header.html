<header>
  {% block extra_styles %}
  <style>
    .notification-count {
      position: absolute;
      top: -10px;
      right: -10px;
      background-color: #dc3545;
      color: #ffffff;
      border-radius: 50%;
      padding: 0.2rem 0.5rem;
      font-size: 10px;
      font-weight: bold;
      min-width: 16px;
      text-align: center;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
      z-index: 10;
    }
    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background-color: #1f2937; /* bg-gray-800 */
      border-radius: 0.375rem; /* rounded-lg */
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      width: 200px;
      z-index: 20;
    }
    .dropdown-menu a {
      display: block;
      padding: 0.5rem 1rem;
      color: #ffffff;
      text-decoration: none;
    }
    .dropdown-menu a:hover {
      background-color: #4b5563; /* hover:bg-gray-700 */
    }
    .profile-img {
      height: 2rem;
      width: 2rem;
      border-radius: 50%;
      object-fit: cover;
    }
    .mobile-menu-content {
      display: none;
    }
    .mobile-menu-content.show {
      display: block;
    }
    @media (max-width: 768px) {
      .notification-count {
        top: -8px; /* Ajuste para mejorar el posicionamiento en pantallas pequeñas */
        right: -8px; /* Ajuste para mejorar el posicionamiento en pantallas pequeñas */
      }
    }
  </style>
  {% endblock %}

  <nav class="border-gray-200 bg-gray-900">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
      <a href="#" class="flex items-center space-x-3 rtl:space-x-reverse">
        <img class="h-6" src="/static/favicon.jpg" alt="Logo"/>
        <span class="self-center text-2xl font-semibold whitespace-nowrap text-white">Click&Go</span>
      </a>
      
      <!-- Mobile menu button -->
      <button id="menu-button" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-400 rounded-lg md:hidden hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-600" aria-controls="mobile-menu" aria-expanded="false">
        <span class="sr-only">Open main menu</span>
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
        </svg>
      </button>

      <!-- Navbar content -->
      <div class="hidden md:flex flex-1 justify-center px-2 lg:ml-6 lg:justify-end space-x-4">
        <!-- Search section -->
        <div class="relative w-full max-w-lg lg:max-w-xs">
          <label for="search" class="sr-only">Search</label>
          <div class="relative text-gray-400 focus-within:text-gray-500">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <input id="search" hx-get="/buscar" hx-trigger="keyup delay:300ms" hx-swap="innerHTML" hx-target="#resultados" class="block w-full rounded-md border border-gray-300 py-2 pl-10 pr-3 leading-5 text-gray-900 placeholder-gray-500 focus:border-purple-500 focus:placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-purple-500 sm:text-sm" placeholder="Search" type="search" name="search">
            <div id="resultados" class="absolute w-full bg-white border border-gray-300 border-t-0 max-h-80 overflow-y-auto shadow-lg hidden z-50"></div>
          </div>
        </div>
      </div>

      <!-- Desktop menu -->
      <div class="hidden md:flex md:w-auto flex-1">
        <ul class="font-medium flex flex-col md:flex-row md:space-x-8 rtl:space-x-reverse mt-4 md:mt-0 p-4 border border-gray-100 rounded-lg bg-gray-800 md:border-0 md:bg-gray-900">
          <li><a href="/" class="block py-2 px-3 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-500 md:p-0">Home</a></li>
          <li><a href="/users" class="block py-2 px-3 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-500 md:p-0">Users</a></li>
          <li><a href="#" class="block py-2 px-3 text-gray-400 rounded hover:bg-gray-700 md:hover:bg-transparent md:border-0 md:hover:text-blue-500 md:p-0">About</a></li>
          <li><a href="#" class="block py-2 px-3 text-gray-400 rounded hover:bg-gray-700 md:hover:bg-transparent md:border-0 md:hover:text-blue-500 md:p-0">Services</a></li>
          <li><a href="#" class="block py-2 px-3 text-gray-400 rounded hover:bg-gray-700 md:hover:bg-transparent md:border-0 md:hover:text-blue-500 md:p-0">Pricing</a></li>
          <li><a href="#" class="block py-2 px-3 text-gray-400 rounded hover:bg-gray-700 md:hover:bg-transparent md:border-0 md:hover:text-blue-500 md:p-0">Contact</a></li>

          <!-- Notification and user profile -->
          <li class="relative flex items-center space-x-4">
            <a href="{% url 'notification_list' %}" class="relative flex items-center">
              <i class="fas fa-bell text-2xl text-white"></i>
              {% if unread_count > 0 %}
              <span class="notification-count">{{ unread_count }}</span>
              {% endif %}
            </a>

            <!-- User Profile -->
            <div class="relative">
              {% if request.user.is_authenticated %}
              <button id="profile-button" class="flex items-center">
                <img class="profile-img" src="{{ user.profile.avatar }}" alt="User Profile"/>
              </button>
              <div id="profile-menu" class="dropdown-menu">
                <ul>
                  <li><a href="{% url 'profile' %}">{{ user.profile.name }}</a></li>
                  <li><a href="{% url 'profile-edit' %}">Edit Profile</a></li>
                  <li><a href="{% url 'profile-settings' %}">Settings</a></li>
                  <li><a href="{% url 'account_logout' %}">Log Out</a></li>
                </ul>
              </div>
              {% else %}
              <div class="flex space-x-4">
                <a href="{% url 'account_login' %}" class="text-white hover:text-blue-500">Login</a>
                <a href="{% url 'account_signup' %}?next={% url 'profile-onboarding' %}" class="text-white hover:text-blue-500">Signup</a>
              </div>
              {% endif %}
            </div>
          </li>
        </ul>
      </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobile-menu" class="mobile-menu-content">
      <ul class="flex flex-col p-4 border border-gray-100 rounded-lg bg-gray-800">
        <li><a href="/" class="block py-2 px-3 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-500">Home</a></li>
        <li><a href="/users" class="block py-2 px-3 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-500">Users</a></li>
        <li><a href="#" class="block py-2 px-3 text-gray-400 rounded hover:bg-gray-700">About</a></li>
        <li><a href="#" class="block py-2 px-3 text-gray-400 rounded hover:bg-gray-700">Services</a></li>
        <li><a href="#" class="block py-2 px-3 text-gray-400 rounded hover:bg-gray-700">Pricing</a></li>
        <li><a href="#" class="block py-2 px-3 text-gray-400 rounded hover:bg-gray-700">Contact</a></li>

        <!-- Notification and user profile in mobile -->
        <li class="relative flex items-center space-x-4 mt-2">
          <a href="{% url 'notification_list' %}" class="flex items-center">
            <i class="fas fa-bell text-xl text-white"></i>
            {% if unread_count > 0 %}
            <span class="notification-count">{{ unread_count }}</span>
            {% endif %}
          </a>

          {% if request.user.is_authenticated %}
          <button id="mobile-profile-button" class="flex items-center">
            <img class="profile-img" src="{{ user.profile.avatar }}" alt="User Profile"/>
          </button>
          <div id="mobile-profile-menu" class="dropdown-menu">
            <ul>
              <li><a href="{% url 'profile' %}">{{ user.profile.name }}</a></li>
              <li><a href="{% url 'profile-edit' %}">Edit Profile</a></li>
              <li><a href="{% url 'profile-settings' %}">Settings</a></li>
              <li><a href="{% url 'account_logout' %}">Log Out</a></li>
            </ul>
          </div>
          {% else %}
          <div class="flex flex-col space-y-2">
            <a href="{% url 'account_login' %}" class="text-white hover:text-blue-500">Login</a>
            <a href="{% url 'account_signup' %}?next={% url 'profile-onboarding' %}" class="text-white hover:text-blue-500">Signup</a>
          </div>
          {% endif %}
        </li>
      </ul>
    </div>
  </nav>

  <!-- JavaScript for menu toggle -->
  <script>
    document.getElementById('menu-button').addEventListener('click', function() {
      const menu = document.getElementById('mobile-menu');
      const expanded = this.getAttribute('aria-expanded') === 'true' || false;
      this.setAttribute('aria-expanded', !expanded);
      menu.classList.toggle('show');
    });

    document.getElementById('profile-button').addEventListener('click', function() {
      const profileMenu = document.getElementById('profile-menu');
      profileMenu.style.display = profileMenu.style.display === 'block' ? 'none' : 'block';
    });

    document.getElementById('mobile-profile-button').addEventListener('click', function() {
      const mobileProfileMenu = document.getElementById('mobile-profile-menu');
      mobileProfileMenu.style.display = mobileProfileMenu.style.display === 'block' ? 'none' : 'block';
    });

    document.body.addEventListener('htmx:afterSwap', function(event) {
      if (event.detail.target.id === 'resultados') {
        event.detail.target.classList.toggle('hidden', event.detail.target.innerHTML.trim() === '');
      }
    });
  </script>
</header>
